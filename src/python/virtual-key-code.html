<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>python 开发中判断键盘事件的坑点 - 虚拟键码 | 知识文档</title>
    <meta name="description" content="探索编程世界与有趣冷知识">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.DVmYFyUi.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.Cn49uvil.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.CPtygWIi.js">
    <link rel="modulepreload" href="/assets/chunks/framework.Cthp9TdA.js">
    <link rel="modulepreload" href="/assets/src_python_virtual-key-code.md.BDJMQeuk.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-adef623d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-5c1f7e10></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-5c1f7e10>Skip to content</a><!--]--><!----><header class="VPNav" data-v-adef623d data-v-a9c1eb9e><div class="VPNavBar" data-v-a9c1eb9e data-v-03622962><div class="wrapper" data-v-03622962><div class="container" data-v-03622962><div class="title" data-v-03622962><div class="VPNavBarTitle has-sidebar" data-v-03622962 data-v-6635a455><a class="title" href="/" data-v-6635a455><!--[--><!--]--><!----><span data-v-6635a455>知识文档</span><!--[--><!--]--></a></div></div><div class="content" data-v-03622962><div class="content-body" data-v-03622962><!--[--><!--]--><div class="VPNavBarSearch search" data-v-03622962><!----></div><!----><!----><div class="VPNavBarAppearance appearance" data-v-03622962 data-v-019a92b4><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-019a92b4 data-v-da0cacdd data-v-1025dc3e><span class="check" data-v-1025dc3e><span class="icon" data-v-1025dc3e><!--[--><span class="vpi-sun sun" data-v-da0cacdd></span><span class="vpi-moon moon" data-v-da0cacdd></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-03622962 data-v-f3e5e05b data-v-2accb262><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-2accb262><span class="vpi-more-horizontal icon" data-v-2accb262></span></button><div class="menu" data-v-2accb262><div class="VPMenu" data-v-2accb262 data-v-2fb1ae18><!----><!--[--><!--[--><!----><div class="group" data-v-f3e5e05b><div class="item appearance" data-v-f3e5e05b><p class="label" data-v-f3e5e05b>Appearance</p><div class="appearance-action" data-v-f3e5e05b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f3e5e05b data-v-da0cacdd data-v-1025dc3e><span class="check" data-v-1025dc3e><span class="icon" data-v-1025dc3e><!--[--><span class="vpi-sun sun" data-v-da0cacdd></span><span class="vpi-moon moon" data-v-da0cacdd></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-03622962 data-v-32fc26fd><span class="container" data-v-32fc26fd><span class="top" data-v-32fc26fd></span><span class="middle" data-v-32fc26fd></span><span class="bottom" data-v-32fc26fd></span></span></button></div></div></div></div><div class="divider" data-v-03622962><div class="divider-line" data-v-03622962></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-adef623d data-v-a40d5709><div class="container" data-v-a40d5709><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a40d5709><span class="vpi-align-left menu-icon" data-v-a40d5709></span><span class="menu-text" data-v-a40d5709>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a40d5709 data-v-8a827091><button data-v-8a827091>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-adef623d data-v-52144e1b><div class="curtain" data-v-52144e1b></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-52144e1b><span class="visually-hidden" id="sidebar-aria-label" data-v-52144e1b> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-4dfea21d><section class="VPSidebarItem level-0 has-active" data-v-4dfea21d data-v-3025dedd><div class="item" role="button" tabindex="0" data-v-3025dedd><div class="indicator" data-v-3025dedd></div><h2 class="text" data-v-3025dedd>Python</h2><!----></div><div class="items" data-v-3025dedd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-3025dedd data-v-3025dedd><div class="item" data-v-3025dedd><div class="indicator" data-v-3025dedd></div><a class="VPLink link link" href="/src/python/" data-v-3025dedd><!--[--><p class="text" data-v-3025dedd>首页</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3025dedd data-v-3025dedd><div class="item" data-v-3025dedd><div class="indicator" data-v-3025dedd></div><a class="VPLink link link" href="/src/python/virtual-key-code.html" data-v-3025dedd><!--[--><p class="text" data-v-3025dedd>虚拟键码对照表</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-4dfea21d><section class="VPSidebarItem level-0" data-v-4dfea21d data-v-3025dedd><div class="item" role="button" tabindex="0" data-v-3025dedd><div class="indicator" data-v-3025dedd></div><h2 class="text" data-v-3025dedd>其他知识</h2><!----></div><div class="items" data-v-3025dedd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-3025dedd data-v-3025dedd><div class="item" data-v-3025dedd><div class="indicator" data-v-3025dedd></div><a class="VPLink link link" href="/src/other/" data-v-3025dedd><!--[--><p class="text" data-v-3025dedd>首页</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-adef623d data-v-47677ef5><div class="VPDoc has-sidebar has-aside" data-v-47677ef5 data-v-64dc5e15><!--[--><!--]--><div class="container" data-v-64dc5e15><div class="aside" data-v-64dc5e15><div class="aside-curtain" data-v-64dc5e15></div><div class="aside-container" data-v-64dc5e15><div class="aside-content" data-v-64dc5e15><div class="VPDocAside" data-v-64dc5e15 data-v-88331f20><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-88331f20 data-v-9e74005b><div class="content" data-v-9e74005b><div class="outline-marker" data-v-9e74005b></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-9e74005b>On this page</div><ul class="VPDocOutlineItem root" data-v-9e74005b data-v-c50c0589><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-88331f20></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-64dc5e15><div class="content-container" data-v-64dc5e15><!--[--><!--]--><main class="main" data-v-64dc5e15><div style="position:relative;" class="vp-doc _src_python_virtual-key-code" data-v-64dc5e15><div><h1 id="python-开发中判断键盘事件的坑点-虚拟键码" tabindex="-1">python 开发中判断键盘事件的坑点 - 虚拟键码 <a class="header-anchor" href="#python-开发中判断键盘事件的坑点-虚拟键码" aria-label="Permalink to &quot;python 开发中判断键盘事件的坑点 - 虚拟键码&quot;">​</a></h1><p>[toc] <img src="/assets/virtual-key-code.CdgS6x9O.png" alt="虚拟键码示意图"></p><h2 id="背景描述" tabindex="-1">背景描述 <a class="header-anchor" href="#背景描述" aria-label="Permalink to &quot;背景描述&quot;">​</a></h2><p>最近，在 Trae 的帮助下，我正在开发一个 Python 项目，这个项目需要判断用户是否按下了特定的键。 我的技术背景是 Java 和 web 前端开发，所以我对 Python 相对比较陌生。跟着 Trae 的指导，我成功地完成了大部分功能，也能加深对 python 的理解。 但是，在开发过程中，我遇到了一个问题，那就是无法获取到用户按下的键的字符。困惑点在于，可以捕捉到一些特定的键，如<code>Ctrl</code>、<code>Shift</code>、<code>Alt</code>等，但是无法捕捉到用户输入的字符。折腾了很久，才发现遇到了一个叫<code>虚拟键码</code>的问题。</p><h2 id="一、什么是虚拟键码" tabindex="-1">一、什么是虚拟键码？ <a class="header-anchor" href="#一、什么是虚拟键码" aria-label="Permalink to &quot;一、什么是虚拟键码？&quot;">​</a></h2><p><strong>虚拟键码（Virtual-Key Code）</strong> 是操作系统为每个物理按键分配的一个固定编号。例如：</p><ul><li><code>A</code> 键对应的虚拟键码是 <code>VK_A = 0x41</code></li><li>回车键是 <code>VK_RETURN = 0x0D</code></li><li>左箭头键是 <code>VK_LEFT = 0x25</code></li></ul><p>这些值与你按的是什么字符无关，只和你按了哪个<strong>物理键</strong>有关。</p><h2 id="二、为什么不能用-key-char" tabindex="-1">二、为什么不能用 <code>key.char</code>？ <a class="header-anchor" href="#二、为什么不能用-key-char" aria-label="Permalink to &quot;二、为什么不能用 `key.char`？&quot;">​</a></h2><p><code>key.char</code> 是按键产生的字符，它会受到以下因素影响：</p><table tabindex="0"><thead><tr><th>影响因素</th><th>对 <code>key.char</code> 的影响</th></tr></thead><tbody><tr><td>输入法</td><td>按下 <code>a</code> 可能变成中文拼音或候选词</td></tr><tr><td>CapsLock 状态</td><td>小写 <code>a</code> 变成大写 <code>A</code></td></tr><tr><td>键盘布局</td><td>同一个键在美式键盘是 <code>Y</code>，德语键盘可能是 <code>Z</code></td></tr><tr><td>组合键（如 AltGr）</td><td>可能输出特殊符号</td></tr></tbody></table><p>所以如果你想知道“用户是不是按了 <strong>左箭头键</strong>”，而他用的是德语键盘或者正在用输入法打字，那么 <code>key.char</code> 很可能无法正确反映他的行为。</p><h2 id="三、举个例子说明" tabindex="-1">三、举个例子说明 <a class="header-anchor" href="#三、举个例子说明" aria-label="Permalink to &quot;三、举个例子说明&quot;">​</a></h2><p>假设你想检测用户是否按下了 <code>A</code> 键：</p><ul><li><p>如果你用：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> key.char </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;a&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span></code></pre></div><p>那么只有当按下 <code>A</code> 键并输出字符 <code>&#39;a&#39;</code> 时才成立。但如果用户：</p></li><li><p>按下了 CapsLock，变成了 <code>&#39;A&#39;</code></p></li><li><p>使用了输入法，比如输入了 “啊”</p></li><li><p>使用的是 AZERTY 键盘，按下的键不是 <code>&#39;a&#39;</code></p><p>上面的判断就失败了。</p></li><li><p>而如果你用：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> key.vk </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> VK_A</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 假设 VK_A 是 A 键的虚拟键码</span></span></code></pre></div><p>不管用户当前是什么键盘布局、有没有开启 CapsLock、有没有使用输入法，只要他按下了那个物理上的 <code>A</code> 键，就能正确识别。</p></li></ul><h2 id="js-中怎么处理-为什么没遇到过这个问题" tabindex="-1">JS 中怎么处理，为什么没遇到过这个问题？ <a class="header-anchor" href="#js-中怎么处理-为什么没遇到过这个问题" aria-label="Permalink to &quot;JS 中怎么处理，为什么没遇到过这个问题？&quot;">​</a></h2><p>为什么在 <strong>JavaScript 开发中不太容易碰到“输入法干扰、CapsLock 影响、键盘布局不同”等问题”，而</strong>Python 开发中更容易遇到这些麻烦。</p><h3 id="javascript-中的键盘事件机制" tabindex="-1">JavaScript 中的键盘事件机制 <a class="header-anchor" href="#javascript-中的键盘事件机制" aria-label="Permalink to &quot;JavaScript 中的键盘事件机制&quot;">​</a></h3><p>在浏览器环境中（如 Web 开发），JS 的 <code>KeyboardEvent</code> 提供了多个属性，比如：</p><ul><li><code>event.key</code></li><li><code>event.code</code></li><li><code>event.keyCode</code> / <code>event.which</code></li><li><code>event.charCode</code></li></ul><h3 id="js-推荐使用-event-code-来判断物理按键" tabindex="-1">JS 推荐使用 <code>event.code</code> 来判断物理按键 <a class="header-anchor" href="#js-推荐使用-event-code-来判断物理按键" aria-label="Permalink to &quot;JS 推荐使用 `event.code` 来判断物理按键&quot;">​</a></h3><ul><li><code>event.code</code> 表示的是<strong>物理键位</strong>，不受输入法、CapsLock、键盘布局影响。 <ul><li>比如按下了 A 键，不管打出来是 a、A、ā 还是 啊，<code>event.code === &#39;KeyA&#39;</code></li></ul></li><li>所以如果你用 <code>event.code</code>，就可以实现类似虚拟键码的功能，和 Python 中使用 <code>key.vk</code> 是一样的思路。</li></ul><h3 id="但-js-一般不会去监听全局快捷键或做底层控制" tabindex="-1">但 JS 一般不会去监听全局快捷键或做底层控制 <a class="header-anchor" href="#但-js-一般不会去监听全局快捷键或做底层控制" aria-label="Permalink to &quot;但 JS 一般不会去监听全局快捷键或做底层控制&quot;">​</a></h3><ul><li>JS 主要运行在浏览器里，权限有限，不能像 Python 那样监听全局按键（比如用户在其他程序中按下 Ctrl+C）。</li><li>所以在浏览器开发中，你通常只关心当前页面内的交互，输入法处理也是由浏览器统一完成的。</li><li>即使你在网页里写快捷键，只要你不依赖 <code>event.key</code> 而改用 <code>event.code</code>，就不会受输入法等干扰。</li></ul><hr><h2 id="python-中为什么更容易碰到这些问题" tabindex="-1">Python 中为什么更容易碰到这些问题？ <a class="header-anchor" href="#python-中为什么更容易碰到这些问题" aria-label="Permalink to &quot;Python 中为什么更容易碰到这些问题？&quot;">​</a></h2><p>Python 作为一门通用编程语言，常用于：</p><ul><li>编写桌面应用</li><li>自动化脚本（如自动点击、全局热键）</li><li>游戏开发（PyGame）</li><li>系统级工具</li></ul><p>在这种场景下，你需要监听用户的<strong>所有按键行为</strong>，甚至包括系统级别的组合键。这时候就不得不面对：</p><table tabindex="0"><thead><tr><th>场景</th><th>问题</th></tr></thead><tbody><tr><td>使用 <code>pynput</code> 或 <code>keyboard</code> 库监听按键</td><td>得到的是字符（<code>char</code>）而不是物理键</td></tr><tr><td>用户正在使用中文输入法</td><td>输入法会拦截按键，导致你无法获取原始键值</td></tr><tr><td>用户换了键盘布局（如德语键盘）</td><td>同一个键可能打出不同的字符</td></tr><tr><td>CapsLock 开启</td><td>小写变大写，判断失败</td></tr></tbody></table><p>所以，在 Python 中如果不特别注意，很容易因为误用了 <code>key.char</code> 而出错。</p><hr><h2 id="js-vs-python-对比总结" tabindex="-1">JS vs Python：对比总结 <a class="header-anchor" href="#js-vs-python-对比总结" aria-label="Permalink to &quot;JS vs Python：对比总结&quot;">​</a></h2><table tabindex="0"><thead><tr><th>特性</th><th>JavaScript (Web)</th><th>Python</th></tr></thead><tbody><tr><td>是否能监听全局按键</td><td>❌ 不行（受限于浏览器沙盒）</td><td>✅ 可以（通过 pynput、pyHook 等库）</td></tr><tr><td>默认监听的事件类型</td><td>浏览器统一处理输入法、布局</td><td>直接与操作系统交互</td></tr><tr><td>常用按键属性</td><td><code>event.code</code>（推荐）、<code>event.key</code></td><td><code>key.char</code>、<code>key.vk</code></td></tr><tr><td>是否受输入法影响</td><td>❌ 一般不直接受影响（浏览器已处理）</td><td>✅ 容易受影响</td></tr><tr><td>是否受键盘布局影响</td><td>❌ 用 <code>code</code> 不受影响</td><td>✅ 容易受影响</td></tr><tr><td>典型应用场景</td><td>快捷键、表单输入</td><td>自动化、游戏、全局热键</td></tr></tbody></table></div></div></main><footer class="VPDocFooter" data-v-64dc5e15 data-v-ceed4eae><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-ceed4eae><span class="visually-hidden" id="doc-footer-aria-label" data-v-ceed4eae>Pager</span><div class="pager" data-v-ceed4eae><a class="VPLink link pager-link prev" href="/src/python/" data-v-ceed4eae><!--[--><span class="desc" data-v-ceed4eae>Previous page</span><span class="title" data-v-ceed4eae>首页</span><!--]--></a></div><div class="pager" data-v-ceed4eae><a class="VPLink link pager-link next" href="/src/other/" data-v-ceed4eae><!--[--><span class="desc" data-v-ceed4eae>Next page</span><span class="title" data-v-ceed4eae>首页</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"u6mMr4Az\",\"readme.md\":\"CE6dJo33\",\"src_other_index.md\":\"Ccq7KSX5\",\"src_other_nalanda-temple.md\":\"BVs9YUve\",\"src_python_index.md\":\"bxWE-OXs\",\"src_python_virtual-key-code.md\":\"BDJMQeuk\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"知识文档\",\"description\":\"探索编程世界与有趣冷知识\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"sidebar\":[{\"text\":\"Python\",\"items\":[{\"text\":\"首页\",\"link\":\"/src/python/\"},{\"text\":\"虚拟键码对照表\",\"link\":\"/src/python/virtual-key-code.md\"}]},{\"text\":\"其他知识\",\"items\":[{\"text\":\"首页\",\"link\":\"/src/other/\"}]}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>